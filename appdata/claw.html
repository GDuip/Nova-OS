<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Nova OS Claw</title>
    <link rel="stylesheet" href="style.css">
    </script>
    <!--ion icons-->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap');

        :root {
            --sizing-huge: 1rem;
            --sizing-normal: 0.5rem;
            --sizing-nano: 0.3rem;

            --vw: 1vw;
            --vh: 1vh;
            --font-size-default: calc((var(--vw) + var(--vh)) / 2);
        }

        ::-webkit-scrollbar {
            width: 0.5rem;
        }

        ::-webkit-scrollbar-track {
            background: #101010;
            border-radius: 0.5rem;
        }

        ::-webkit-scrollbar-thumb {
            background: #1f1f1f;
            border-radius: 0.5rem;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #2f2f2f;
            cursor: grab;
        }

        ::-webkit-scrollbar-thumb:active {
            cursor: grabbing;
        }

        html {
            height: 100%;
            width: 100%;
            font-size: var(--font-size);
        }

        button,
        input,
        textarea {
            outline: none;
            font-family: inherit;
            font-size: inherit;
            color: inherit;
        }

        button {
            cursor: pointer;
        }

        body {
            padding: 0.3rem;
            background-color: #101010;
            color: white;
            font-family: 'Poppins', sans-serif;
            user-select: none;
            height: calc(100% - 2rem);
        }

        #main {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            height: 100%;
            gap: 0.5rem;
        }

        #main #feedsection,
        #main #toolsection {
            width: 0;
        }

        #main #feedsection {
            flex: 3;
            display: flex;
            flex-direction: column;
        }

        #main #toolsection {
            flex: 1;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .searchsection {
            display: flex;
            flex-direction: row;
            background: #1f1f1f;
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem 0.7rem;
        }

        input#searchinput {
            width: 0;
            flex: 1;
            border: none;
            background-color: transparent;
        }

        .searchsection button {
            background: transparent;
            border: none;
            padding: 0;
            color: inherit;
            opacity: 80%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .navtools {
            background: #1f1f1f;
            padding: 0.3rem;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        #feed {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            gap: 0.5rem;
            flex: 1;
            padding: 0.3rem;
        }

        .randompost {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: #1f1f1f;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .more {
            opacity: 0;
            transition: .3s;
        }

        .randompost:hover .more {
            opacity: 0.7;
        }

        .postuserdata {
            display: flex;
            flex-direction: row;
            gap: 0.5rem;
        }

        .postuseravatar {
            width: 40px;
            height: 40px;
            aspect-ratio: 1 / 1;
            overflow: hidden;
        }

        .postuseravatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 1rem;
        }

        .postfooter {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
            align-items: center;
        }

        .postfooter .likes ion-icon {
            color: #ff9a9a;
        }

        .postcontent {
            font-size: 110%;
            margin: 0.7rem 0px;
        }

        .more button {
            border-radius: 10px;
            padding: 4px 10px;
            background: #161616;
            border: none;
            color: inherit;
            font-size: 80%;
        }

        .likes {
            background: #161616;
            display: flex;
            padding: 5px 8px;
            border-radius: 0.5rem;
            cursor: pointer;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 5px;
        }

        span.likesnumber {
            font-size: 80%;
        }

        .posttimestamp {
            font-size: 80%;
            opacity: 70%;
        }

        .quotebtn {
            background-color: #4e5fa7 !important;
        }

        nav#nav {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            opacity: 0.7;
            padding: 10px;
        }

        #postinput {
            background: #1f1f1f;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: none;
            width: calc(100% - 1rem);
            min-width: 0;
            max-height: 70vh;
            font-size: 130%;
            height: 150px;
            resize: vertical;
        }

        .postmsgsection {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }

        button.postbtn {
            background: #4e5fa7;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 4px;
            border: none;
            padding: 3px 10px;
            border-radius: 0.5rem;
            padding-right: 5px;
        }
    </style>
</head>

<body>
    <main id="main">
        <div id="feedsection">
            <nav id="nav">
                <span class="logo">
                    NovaOS Claw
                </span>
                <div class="navtools" onclick="loadFeed()">
                    <ion-icon name="arrow-up-circle-outline" title="Refresh feed"></ion-icon>
                </div>
            </nav>
            <div id="feed">

            </div>
        </div>
        <div id="toolsection">
            <div class="searchsection">
                <input id="searchinput" placeholder="Search posts...">
                <button onclick="searchclaw()">
                    <ion-icon name="search-outline"></ion-icon>
                </button>
            </div>
            <div class="postmsgsection">
                <textarea id="postinput" placeholder="What is going on!?"></textarea>
                <button onclick="sendmsg()" class="postbtn">
                    <span>Post</span>
                    <ion-icon name="chevron-forward-outline"></ion-icon>
                </button>
            </div>
        </div>
    </main>

    <script>
        async function loadFeed() {
            const response = await fetch("https://claw.rotur.dev/feed?limit=5");
            const posts = await response.json();
            const feedContainer = document.getElementById("feed");
            feedContainer.innerHTML = "";

            let lastUser = null;

            posts.forEach(post => {
                const postElement = document.createElement("div");
                postElement.classList.add("randompost");

                postElement.innerHTML = `
        ${post.user !== lastUser ? `
        <div class="postnav">
            <div class="postuserdata">
                <div class="postuseravatar">
                    <img class="postuseravatarsrc" src="${post.pfp}">
                </div>
                <div class="postuserdynamics">
                    <div class="postusername">${post.user}</div>
                    <div class="posttimestamp">${timeSince(post.timestamp)}</div>
                </div>
            </div>
        </div>
        ` : ''}
        <div class="postcontent">${post.content}</div>
        <div class="postfooter">
            <div class="likes" onclick="likepost('${post.id}')">
                <ion-icon name="heart-outline"></ion-icon>
                <span class="likesnumber">${post.likes ? post.likes.length : 0}</span>
            </div>
            <div class="more">
                <button onclick="copyId('${post.id}')">Copy ID</button>
                <button class="quotebtn">Quote</button>
            </div>
        </div>
    `;

                feedContainer.appendChild(postElement);
                lastUser = post.user;
            });
        }

        async function likepost(id) {
            await fetch("https://claw.rotur.dev/rate?id="+ id+ "&auth=" + 
            window.parent.roturExtension.userToken + "&rating=1");
            loadFeed()
        }

        function timeSince(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            const intervals = [
                { label: 'year', seconds: 31536000 },
                { label: 'month', seconds: 2592000 },
                { label: 'day', seconds: 86400 },
                { label: 'hour', seconds: 3600 },
                { label: 'minute', seconds: 60 },
            ];
            for (const interval of intervals) {
                const count = Math.floor(seconds / interval.seconds);
                if (count >= 1) return `${count} ${interval.label}${count !== 1 ? 's' : ''} ago`;
            }
            return "Just now";
        }

        function copyId(id) {
            navigator.clipboard.writeText(id);
        }

        loadFeed();
    </script>
</body>

</html>